def commit_id

pipeline {
 agent none

options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')
}

   tools {
  maven 'Maven3.8.1'
}

   stages {
    stage('Preparation') {
     steps {
       script{
        checkout scm
         sh "git rev-parse --short HEAD > .git/commit-id"                        
         commit_id = readFile('.git/commit-id').trim()
    }
  }
} 
   
     stage('Generate Build Artifact') {
        steps {
         sh 'mvn clean install'
        
        }
     }
     stage('SonarQube Analysis') {
        environment {
        scannerHome = tool 'sonarqube4.6'
        }
        steps {
           withSonarQubeEnv('SonarQubeServer')  {
           sh "${scannerHome}/bin/sonar-scanner"
}
  }
     }
      
  }
}
