def commit_id

pipeline {
 agent any

options {
  buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '5')
}

   tools {
  maven 'Maven3.8.1'
}

   stages {
    stage('Preparation') {
     steps {
       script{
        checkout scm
         sh "git rev-parse --short HEAD > .git/commit-id"                        
         commit_id = readFile('.git/commit-id').trim()
    }
  }
} 
   
     stage('Generate Build Artifact') {
        steps {
         sh 'mvn clean install'
        
        }
     }
     stage('SonarQube Analysis') {
        environment {
        scannerHome = tool 'sonarqube4.6'
        }
        steps {
           withSonarQubeEnv('SonarQubeServer')  {
            sh "${scannerHome}/bin/sonar-scanner"
          /* sh """${scannerHome}/bin/sonar-scanner \
           -D sonar.projectVersion=2.0-SNAPSHOT \
           -D sonar.login=admin \
           -D sonar.password=Sibu@2272 \
           -D sonar.projectBaseDir=/var/lib/jenkins/workspace/newProject/ \
           -D sonar.projectKey=maven-web-application \
           -D sonar.sourceEncoding=UTF-8 \
           -D sonar.language=java \
           -D sonar.sources=/var/lib/jenkins/workspace/newProject/src/main \
           -D sonar.tests=/var/lib/jenkins/workspace/newProject/src/test \
           -D sonar.host.url=http://11.2.2.4:9000/""" */
}
  }
     }
      
  }
}
